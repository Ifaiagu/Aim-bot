-- DaviBOT_Hub - by DAVI (versão perfeita)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local UserInputService = game:GetService("UserInputService")

-- Funções do sistema
local AimbotEnabled = false
local AutoShootEnabled = false
local ESPEnabled = false
local TeamCheck = false
local AimPart = "Head"
local FOVSize = 100
local FOVColor = Color3.fromRGB(255, 255, 0)
local ESPColor = Color3.fromRGB(0, 255, 0)

-- Rayfield UI
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "DaviBOT Hub",
    LoadingTitle = "DaviBOT",
    LoadingSubtitle = "by ChatGPT",
    ConfigurationSaving = {
        Enabled = false
    },
    Discord = { Enabled = false },
    KeySystem = false
})

local MainTab = Window:CreateTab("Main", 4483362458)

-- FOV Circle
local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = true
FOVCircle.Thickness = 1
FOVCircle.Color = FOVColor
FOVCircle.Radius = FOVSize
FOVCircle.Filled = false
FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

RunService.RenderStepped:Connect(function()
    FOVCircle.Radius = FOVSize
    FOVCircle.Color = FOVColor
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
end)

-- ESP System
local function createESP(player)
    if player == LocalPlayer then return end

    local espFolder = Instance.new("Folder", game.CoreGui)
    espFolder.Name = player.Name .. "_ESP"

    local box = Drawing.new("Square")
    box.Thickness = 1
    box.Color = ESPColor
    box.Filled = false

    local name = Drawing.new("Text")
    name.Size = 14
    name.Color = ESPColor
    name.Center = true
    name.Outline = true

    local connection
    connection = RunService.RenderStepped:Connect(function()
        if not ESPEnabled or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") or player.Character:FindFirstChild("Humanoid").Health <= 0 then
            box.Visible = false
            name.Visible = false
            return
        end

        local pos, onScreen = Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
        if onScreen then
            local head = player.Character:FindFirstChild("Head")
            local hrp = player.Character:FindFirstChild("HumanoidRootPart")
            if head and hrp then
                local top = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
                local bottom = Camera:WorldToViewportPoint(hrp.Position - Vector3.new(0, 2.5, 0))

                local height = math.abs(top.Y - bottom.Y)
                local width = height / 2

                box.Size = Vector2.new(width, height)
                box.Position = Vector2.new(pos.X - width / 2, pos.Y - height / 2)
                box.Visible = true
                box.Color = ESPColor

                name.Text = player.Name
                name.Position = Vector2.new(pos.X, pos.Y - height / 2 - 15)
                name.Visible = true
                name.Color = ESPColor
            end
        else
            box.Visible = false
            name.Visible = false
        end
    end)

    player.AncestryChanged:Connect(function(_, parent)
        if not parent then
            box:Remove()
            name:Remove()
            connection:Disconnect()
        end
    end)
end

Players.PlayerAdded:Connect(createESP)
for _, p in ipairs(Players:GetPlayers()) do
    createESP(p)
end

-- Funções principais
local function getClosest()
    local closest, distance = nil, math.huge
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Humanoid") and p.Character.Humanoid.Health > 0 then
            if TeamCheck and p.Team == LocalPlayer.Team then continue end

            local part = p.Character:FindFirstChild(AimPart)
            if part then
                local screenPos, onScreen = Camera:WorldToViewportPoint(part.Position)
                if onScreen then
                    local dist = (Vector2.new(screenPos.X, screenPos.Y) - Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)).Magnitude
                    local ray = Ray.new(Camera.CFrame.Position, (part.Position - Camera.CFrame.Position).Unit * 500)
                    local hit = workspace:FindPartOnRay(ray, LocalPlayer.Character)
                    if hit and hit:IsDescendantOf(p.Character) and dist < distance and dist < FOVSize then
                        closest = part
                        distance = dist
                    end
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    if AimbotEnabled then
        local target = getClosest()
        if target then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Position)
            if AutoShootEnabled then
                mouse1click()
            end
        end
    end
end)

-- UI Toggles
MainTab:CreateToggle({
    Name = "Aimbot",
    CurrentValue = false,
    Callback = function(v) AimbotEnabled = v end
})

MainTab:CreateToggle({
    Name = "Auto Shoot",
    CurrentValue = false,
    Callback = function(v) AutoShootEnabled = v end
})

MainTab:CreateToggle({
    Name = "ESP",
    CurrentValue = false,
    Callback = function(v) ESPEnabled = v end
})

MainTab:CreateToggle({
    Name = "Team Check",
    CurrentValue = false,
    Callback = function(v) TeamCheck = v end
})

MainTab:CreateDropdown({
    Name = "AimPart",
    Options = { "Head", "HumanoidRootPart" },
    CurrentOption = "Head",
    Callback = function(v) AimPart = v end
})

MainTab:CreateSlider({
    Name = "FOV Size",
    Range = { 50, 500 },
    Increment = 5,
    CurrentValue = 100,
    Callback = function(v) FOVSize = v end
})

MainTab:CreateColorPicker({
    Name = "FOV Color",
    Color = FOVColor,
    Callback = function(c) FOVColor = c end
})

MainTab:CreateColorPicker({
    Name = "ESP Color",
    Color = ESPColor,
    Callback = function(c) ESPColor = c end
})
